<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance Admin</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 20px; }
    h1 { color: #6cf; }
    .row { margin: 0.5em 0; }
    label { display: inline-block; width: 160px; }
    input, textarea, select { width: 300px; padding: 4px; }
    button { margin-left: 164px; margin-top: 0.25em; }
    .toolbar { margin-top: 1em; padding: 1em; border: 1px solid #444; }
  </style>
</head>
<body>
  <h1>Tempest Attendance Admin</h1>

  <div class="row">
    <label for="backend">Backend URL:</label>
    <input id="backend" value="https://tempest-attendance.onrender.com/api/attendance">
  </div>
  <div class="row">
    <label for="token">Admin Token:</label>
    <input id="token" placeholder="enter ATTEND_ADMIN_TOKEN">
  </div>

  <div class="toolbar">
    <strong>Data Management</strong><br>
    <button onclick="exportState()">Export JSON</button>
    <button onclick="importState()">Import JSON</button>
    <input type="file" id="importFile" style="display:none">
  </div>

  <pre id="log"></pre>

  <script>
    function log(msg) {
      document.getElementById('log').textContent += msg + "\n";
    }
    async function exportState() {
      const base = document.getElementById('backend').value;
      const token = document.getElementById('token').value;
      try {
        const res = await fetch(base + '/export', {
          headers: { 'x-admin-token': token }
        });
        if (!res.ok) throw new Error(await res.text());
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'attendance-export.json';
        a.click();
        log('Export successful');
      } catch (e) { log('Export failed: ' + e.message); }
    }
    function importState() {
      const input = document.getElementById('importFile');
      input.onchange = async () => {
        const file = input.files[0];
        if (!file) return;
        const text = await file.text();
        const base = document.getElementById('backend').value;
        const token = document.getElementById('token').value;
        try {
          const res = await fetch(base + '/import', {
            method: 'POST',
            headers: {
              'x-admin-token': token,
              'Content-Type': 'application/json'
            },
            body: text
          });
          if (!res.ok) throw new Error(await res.text());
          log('Import successful');
        } catch (e) { log('Import failed: ' + e.message); }
      };
      input.click();
    }
  </script>
</body>
</html>
